AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Resources:
  OAuthHandler:
    Type: AWS::Serverless::Function
    Properties:
      Description: Accepts POST from TD Ameritrade and saves oauth data to ssm
      Handler: main
      Runtime: go1.x
      Timeout: 6
      CodeUri: ../../dist/main.zip 
      Environment:
        Variables: 
          # Client ID you specified in your app creation. 
          CLIENT_ID: YOUR-CLIENT-ID@AMER.OAUTHAP
          # API Gateway route generated by SaveKeys event below.
          # Use this value in creating your TD Ameritrade app.
          REDIRECT_URI: YOUR-REDIRECT-URI 
      Events:
        SaveKeys:
          Type: Api
          Properties:
            Path: /
            Method: get
        GetCachedKeys:
          Type: Api
          Properties:
            Path: /cache
            Method: get
      Policies:
        - AmazonSSMFullAccess